const { keith } = require('../commandHandler');
const axios = require('axios');
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//========================================================================================================================
//
keith({
  pattern: "tiktokstalk",
  aliases: ["ttstalk", "stalktiktok"],
  description: "Stalk TikTok profile using username",
  category: "stalker",
  filename: __filename
}, async (from, client, conText) => {
  const { q, reply, mek } = conText;

  if (!q) return reply("âŒ Provide a TikTok username.\n\nExample: tiktokstalk keizzah4189");

  try {
    const res = await axios.get(`https://apiskeith.vercel.app/stalker/tiktok?user=${encodeURIComponent(q)}`);
    const data = res.data;

    if (!data.status || !data.result?.profile) {
      return reply("âŒ Failed to fetch TikTok profile. Make sure the username is correct.");
    }

    const { profile, stats } = data.result;
    const caption = `ğŸ‘¤ *TikTok Profile: @${profile.username}*\n\n` +
      `ğŸ“› Name: ${profile.nickname}\n` +
      `ğŸ†” ID: ${profile.id}\n` +
      `ğŸ”— Bio: ${profile.bio || "â€”"}\n` +
      `ğŸŒ Language: ${profile.language}\n` +
      `ğŸ”’ Private: ${profile.private ? "Yes" : "No"}\n` +
      `âœ… Verified: ${profile.verified ? "Yes" : "No"}\n` +
      `ğŸ“… Created: ${new Date(profile.createdAt).toDateString()}\n\n` +
      `ğŸ“Š *Stats*\n` +
      `ğŸ‘¥ Followers: ${stats.followers}\n` +
      `ğŸ‘£ Following: ${stats.following}\n` +
      `â¤ï¸ Likes: ${stats.likes}\n` +
      `ğŸ¬ Videos: ${stats.videos}\n` +
      `ğŸ§‘â€ğŸ¤â€ğŸ§‘ Friends: ${stats.friends}`;

    await client.sendMessage(from, {
      image: { url: profile.avatars.large },
      caption
    }, { quoted: mek });
  } catch (err) {
    console.error("tiktokstalk error:", err);
    reply("âŒ Error fetching TikTok profile: " + err.message);
  }
});
